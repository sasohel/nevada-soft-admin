<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Matches extends CI_Controller {	function __construct(){		parent::__construct();				$this->load->database();		$this->load->library('session');		$this->lang->load('login');		$this->load->helper('URL');		$this->load->model('league_mod');		$this->load->helper('date');		date_default_timezone_set("Asia/Dhaka");	}		public function index($lid='',$action='', $id=''){			if($this->session->userdata('uid')!='' && $this->session->userdata('uid') > 0){			$data['ccss'] = $this->config->config['ccss'];			$data['cjs'] = $this->config->config['cjs'];						$data['title'] = 'Matches';			$data['login_box_header'] = $this->lang->line('login_box_header');						$data['base_url'] = $this->config->config['base_url'];						$data['dclass'] = 'matches'; 			$data['timediff'] = $this->league_mod->get_league_lcl_time_diff($lid);						if($this->input->post('match-submit')){				if(count($_POST)>0){					$f = $this->league_mod->update_match($_POST);                                        // when match over                    if(isset($_POST['status']) && $_POST['status'] == 3){                        $match_info = $this->league_mod->get_match_info($id);                        $tema_hside = array();                        $tema_aside = array();                        $full_score = explode('-', $match_info[0]->ftscore);                                                $tema_hside['id'] = $match_info[0]->hside;                        $tema_aside['id'] = $match_info[0]->aside;                        $tema_hside['score'] = $full_score[0];                        $tema_aside['score'] = $full_score[1];                        $tema_hside['gf'] = $tema_hside['score'];                        $tema_aside['gf'] = $tema_aside['score'];                        $tema_hside['ga'] = $tema_aside['score'];                        $tema_aside['ga'] = $tema_hside['score'];                        $tema_hside['gd'] = $tema_hside['gf'] - $tema_hside['ga'];                        $tema_aside['gd'] = $tema_aside['gf'] - $tema_aside['ga'];                                                // get team points & others                        if($tema_hside['score'] == $tema_aside['score']){ // match is draw                            $tema_hside['points'] = 1;                            $tema_aside['points'] = 1;                            $tema_hside['win'] = 0;                            $tema_aside['win'] = 0;                            $tema_hside['draw'] = 1;                            $tema_aside['draw'] = 1;                            $tema_hside['lost'] = 0;                            $tema_aside['lost'] = 0;                        } elseif($tema_hside['score'] > $tema_aside['score']) {                            $tema_hside['points'] = 3;                            $tema_aside['points'] = 0;                            $tema_hside['win'] = 1;                            $tema_aside['win'] = 0;                            $tema_hside['draw'] = 0;                            $tema_aside['draw'] = 0;                            $tema_hside['lost'] = 0;                            $tema_aside['lost'] = 1;                        }elseif($tema_hside['score'] < $tema_aside['score']) {                            $tema_hside['points'] = 0;                            $tema_aside['points'] = 3;                            $tema_hside['win'] = 0;                            $tema_aside['win'] = 1;                            $tema_hside['draw'] = 0;                            $tema_aside['draw'] = 0;                            $tema_hside['lost'] = 1;                            $tema_aside['lost'] = 0;                        }                    }                    $teams = array($tema_hside, $tema_aside);                    $this->league_mod->update_team_after_match_over($teams);					if($f){						redirect('matches/'.$lid);					}				}			}			if(isset($action) && $action=='edit' && is_numeric($id) && $id > 0){				$data['action'] = 'edit';				$data['mdata'] = $this->league_mod->get_match_info($id);   				$data['mstatus'] = $this->league_mod->get_match_statuses();				$data['leagues'] = $this->league_mod->get_all_league();				$data['teams'] = $this->league_mod->get_all_teams_by_league($lid);				$data['tweek'] = $this->league_mod->get_total_week($lid);			}						if(isset($action) && $action=='delete' && is_numeric($id) && $id > 0){				$f = $this->league_mod->delete_match($id);				if($f){					redirect('matches/'.$lid);				}			}									if(isset($lid) && is_numeric($lid)){				$data['cmatches'] = $this->league_mod->get_league_matches($lid, TRUE);								$data['smatches'] = $this->league_mod->get_league_matches($lid, FALSE);								$data['league'] = $this->league_mod->get_league_name_by_id($lid);								$data['lid'] = $lid;							}									$this->load->view('header',$data);						$this->load->view('matches', $data);			$this->load->view('footer'); 		}		else{			redirect('');		}			}	}