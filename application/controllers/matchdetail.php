<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Matchdetail extends CI_Controller {	function __construct(){		parent::__construct();				$this->load->database();		$this->load->library('session');		$this->lang->load('matchdetail');		$this->load->helper('URL');		$this->load->model('matchdetail_mod');		$this->load->model('league_mod');	}		public function index($lid, $mid, $action='',$act_id=''){		if($this->session->userdata('uid')!='' && $this->session->userdata('uid') > 0){			$data['ccss'] = $this->config->config['ccss'];			$data['cjs'] = $this->config->config['cjs'];						$data['title'] = $this->lang->line('page_title');			$data['login_box_header'] = $this->lang->line('login_box_header');						$data['base_url'] = $this->config->config['base_url'];						$data['dclass'] = 'matchdetail'; 						$data['timediff'] = $this->league_mod->get_league_lcl_time_diff($lid);            /* previous action edit */			if($this->input->post('match_action_submit')){				if(count($_POST)>0){					$f = $this->matchdetail_mod->update_match_action($_POST);					if($f){						redirect('matchdetail/'.$lid.'/'.$mid);					}				}			}						/* new action add */			if($this->input->post('match_action_add')){				if(count($_POST)>0){					$f = $this->matchdetail_mod->add_match_action($_POST);					if($f){						redirect('matchdetail/'.$lid.'/'.$mid);					}				}			}			if(isset($action) && $action=='delete' && is_numeric($act_id) && $act_id > 0){				$f = $this->matchdetail_mod->delete_match_action($act_id);				if($f){					redirect('matchdetail/'.$lid.'/'.$mid);				}			}			$data['mschedule'] = $this->matchdetail_mod->get_match_info($mid);						$data['mstatus'] = $this->matchdetail_mod->get_match_statuses();			$data['league'] = $this->league_mod->get_league_name_by_id($lid);							if(isset($mid) && is_numeric($mid)){				$data['mdetails'] = $this->matchdetail_mod->get_matchdetail_by_id($mid);			}						/* set match id */			$data['matchid'] = $mid;			$data['leagueid'] = $lid;						/* get match teams */			$data['teams'] = $this->matchdetail_mod->match_teams($mid);						/* match record edit */			if(isset($action) && $action=='edit'){				$data['action'] = 'edit';                $data['players'] = $this->matchdetail_mod->get_players($mid);				$data['maction'] = $this->matchdetail_mod->get_match_action_by_id($act_id);			}												$data['lid'] = $lid;			$this->load->view('header',$data);						$this->load->view('matchdetail', $data);			$this->load->view('footer'); 		}		else{			redirect('');		}		}	public function lineup($lid, $mid){		if($this->session->userdata('uid')!='' && $this->session->userdata('uid') > 0){			$data['ccss'] = $this->config->config['ccss'];			$data['cjs'] = $this->config->config['cjs'];						$data['title'] = 'Update Lineup';			$data['login_box_header'] = $this->lang->line('login_box_header');						$data['base_url'] = $this->config->config['base_url'];						$data['dclass'] = 'matchdetail'; 						$data['message'] = array();			$data['errors'] = array();            $data['match_lineup']  = (array)$this->matchdetail_mod->get_lineup($mid);			$teams = $this->matchdetail_mod->match_teams($mid);                        $data['home_team'] = $teams[0]->hside_title;            $data['away_team'] = $teams[0]->aside_title;            $home_team = $this->matchdetail_mod->get_team_players_by_team_id($teams[0]->hside);            $data['home_coach'] = $home_team['coach'];            $data['home_players'] = $home_team['players'];                        $away_team = $this->matchdetail_mod->get_team_players_by_team_id($teams[0]->aside);            $data['away_coach'] = $away_team['coach'];            $data['away_players'] = $away_team['players'];						$data['lid'] = $lid;			$data['matchid'] =$mid;			if($this->input->post('update_lineup')){				if(count($_POST)>0){					$info = $_POST;//                                        echo '<pre>';//                                        var_dump($_POST);//                                        echo '</pre>';					if(isset($info['hp']) && count($info['hp']) != 11){							$data['errors'][] = 'Home player list is not valid';					}					else if(count($info['hs']) != 7){						$data['errors'][] = 'Home substitute player list is not valid';					}					else if(isset($info['ap']) && count($info['ap']) != 11){						$data['errors'][] = 'Away player list is not valid';					}					else if(isset($info['as']) && count($info['as']) != 7){						$data['errors'][] = 'Away substitute player list is not valid';					}					else if((isset($info['hp']) && count($info['hp']) == 11)                                                && (isset($info['hs']) && count($info['hs']) == 7)                                                 && (isset($info['ap']) && count($info['ap']) == 11)                                                 && (isset($info['as']) && count($info['as']) == 7)){												$hcommon = array_intersect($info['hp'], $info['hs']);						$acommon = array_intersect($info['ap'], $info['as']);						if(!empty($hcommon)){							$data['errors'][] = 'There common players in home side players and substitute players';							}						else if(!empty($acommon)){							$data['errors'][] = 'There common players in away side players and substitute players';							}						else{                            if($data['match_lineup']){                                $f = $this->matchdetail_mod->update_lineup($_POST);                            } else {                                $f = $this->matchdetail_mod->create_lineup($_POST);                                if($f){                                    $this->matchdetail_mod->update_schedule_status($mid);                                }                            }                            							if($f){								redirect('matchdetail/'.$lid.'/'.$mid);							}						}					}									}			}						$this->load->view('header',$data);						$this->load->view('lineup', $data);			$this->load->view('footer'); 		}		else{			redirect('');		}		}		}